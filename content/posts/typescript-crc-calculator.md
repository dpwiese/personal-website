---
title: "Single Page CRC Calculator with TypeScript"
date: 2020-07-18T17:49:17-05:00
draft: true
toc: false
# ADD OG IMAGE WITH THIS POST:
images: ["img/posts/data-conversions/og-image.png"]
tags: 
  - programming
  - typescript
keywords: [programming, typescript]
---

# Introduction

This post describes the process of creating a very simple single page for performing a CRC-32 calculation.
At a technical level it is trivial - the result is a single HTML page, styled with straightforward CSS, and using a few lines of JavaScript to perform a CRC-32 calculation.
No effort will be spent to describe how the CRC calculation is done.
The motivation for creating this page was to facilitate remote collaboration, documenting, and troubleshooting CRC calculation checks.
As the data and the corresponding CRC values are generated on and transmitted and validated across many parts of a tech stack, it's helpful to have a persistent and centralized way to validate a check value on some input data.
Specifically, a webpage which allows a payload to be entered as a query parameter and persisted after the CRC check is performed.
Moreover, the source code which performs the check is available for all to see and even edit in a browser as desired.

The result can be found here: [CRC Calculator]( {{< ref "/crc-calculator.md" >}} ) and the source code here: <a href="https://github.com/dpwiese/crc-calculator" target="_blank">htt<span></span>ps://github.com/dpwiese/crc-calculator</a>.
This post was inspired by the <a href="http://www.ghsi.de/pages/subpages/Online%20CRC%20Calculation/" target="_blank">GHS Infotronic Online CRC Calculation</a>.
While there are many other websites that can perform such simple calculations, I particularly liked that this one kept the polynomial and message in the query parameters, allowing specific inputs, and thus the corresponding outputs, to be easily shared with a single hyperlink.
However, I was unable to find a similar site to calculate CRC-32 checksum using query parameters, leading to this post.

## Implementation

To recap, the goal for this project was to make:

* A **single page** with a form to allow inputting of a payload and submission to calculate the resulting CRC-32
* Require **minimal tooling** to build
* **Persist the input in the query parameters** to easily save and share

To satisfy these goals, I initially wrote a single HTML page with embedded JavaScript and CSS.
The CRC calculation algorithm is very well documented and simple implementations can be found in nearly every language, making the implementation of the algorithm quite straightfoward.
For example, the [tahapaksu.com Online CRC Calculation](https://www.tahapaksu.com/crc/) page used the few lines of JavaScript needed to calculate a CRC-32 (as well as several other) checksum.

After this first pass I quickly became uncomfortable working with the CRC-32 algorithm without types, as the functions were using hex strings, typed arrays, numbers, and more, which quickly became difficult to keep track of.
I also wanted to an easy way to test the few functions required to ingest the data enter by the user and calculate the CRC-32.
As I'd never worked with TypeScript before, I decided to give it a try.
The result was a very simple TypeScript file, some tests with Jest, and and the extraction of the JavaScript code to an external file which was generated by the TypeScript compiler.

I'm pleased with this approach for a simple way to perform manipulations on data, and may implement other simple utilities similarly.
I don't have to concern myself with any tooling and can just write the functions I want, for example converting between different numeric types like base-64 strings, 64 bit floats, etc., and some associated tests.
Then just complile them into JavaScript and upload as a static file for others to test and use.

I think it sufficiently lowers the bar versus the alternatives, which may be hosting a Python script or something which someone then needs to download, install dependencies, interact via the command line without persisting inputs, and can only share with others by sharing the script itself.

## Notes

* Rewire used to test the JavaScript code as opposed to the TypeScript code.

```ts
const Utils = rewire("../built/crc-utils.js");
```

* Simple unit tests to make sure utilities are working as expected

```ts
test('conditionHexString', () => {
  const conditionHexString = Utils.__get__('conditionHexString');
  expect(isEqual(conditionHexString("abc"), "ABC")).toBe(true);
  expect(isEqual(conditionHexString("ghi"), null)).toBe(true);
  expect(isEqual(conditionHexString("0xABC123"), null)).toBe(true);
  expect(isEqual(conditionHexString("ABC"), "ABC")).toBe(true);
  expect(isEqual(conditionHexString("AbCd123"), "ABCD123")).toBe(true);
});
````

* The utility functions

```ts
function hexStringToByteArray(hexString: string): Uint8Array {
  const byteArrayLength = hexString.length / 2;
  var arrayBuffer: ArrayBuffer = new ArrayBuffer(byteArrayLength);
  var byteArray: Uint8Array = new Uint8Array(arrayBuffer);
  for (var i: number = 0; i < byteArrayLength; i += 1) {
    byteArray[i] = parseInt(hexString.substr(i * 2, 2), 16);
  }
  return byteArray;
}
```

&nbsp;

```ts
function changeEndianness(string: string): string {
  const result: Array<string> = [];
  let len: number = string.length - 2;
  while (len >= 0) {
    result.push(string.substr(len, 2));
    len -= 2;
  }
  return result.join('');
}
```

